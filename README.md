# ImageScaling
Repo for storing DSP group project files

Read me file for the vhdl/verification files for scale down by two algorithm.
-----------------------------------------------------------------------------
The project is organized similar to the lab projects with src, run, and tb
directory with their usual contents. One extra folder is included called
verification with etra matlab files and images used for testing the
implementation. The following provides a brief description of each file:

1) verification/write_blk_rom_vhdl_file.m
  This matlab script actually generates a "blk_rom.vhd" file which when
  compiled contains the input image in a Block ROM. All the code needed
  to infer a block ROM is generated by this script. It essentially, takes
  an input image, converts it to 1D linear row major array in binary,
  calculates the dimensions of ROM array, address ranges etc and writes
  it to a vhd files along with the other VHDL syntax needed for a valid
  vhdl file.
2) verification/write_blk_ram_file.m
  This matlab script is similar to the ROM generating script but instead
  generates a RAM of the same size as the expected output. RAM is not 
  pre-loaded with input image, instead it is used for storing the scaled
  down image. Since the output is scaled down by 2 in both dimensions,
  RAM block is 1/4 size of ROM. Once scaled output is generated, VGA
  module reads from this ram to display output on screen via VGA port.
  All vhdl syntax for block RAM inferrence by vivado is generated by
  this matlab script and nothing else needs to be done to compile the
  RAM module.
3) src/blk_rom.vhd
  This is the ROM vhdl source file generated by the previous matlab script.
  The input image is stored in this ROM.
4) This is the RAM vhdl source file generated by the matlab script. The
  output image will be stored in RAM.
5) src/scale_down_two.vhd
  This file is the main implementation of the scale down by two using
  nearest neighbor algorithm. The code essentially reads the input image
  from ROM and decimates every other row and column to reduce the size
  by 2 in each dimension. The output image is stored in RAM. This module
  also output each pixel at the output port one pixel each clock cycle
  after 2 clock cycle latency along with a valid signal. The testbench
  captures this output and writes an output txt file for verification.
6) tb/tb_scale_down_two.vhd
  This is the VHDL testbench for the scale down by two module. This reads
  the output image pixel by pixel using the valid signal and writes it to
  a text file "output_img.txt". This file contains one pixel per line, and
  the pixels are in row major form.
7) verification/scale_down_two_test.m
  This file takes the output of the testbench "output_img.txt", reads it,
  reshapes it to the expected scaled down width and height and shows a
  comparson with the gold standard expected outcome.
8) uart.vhd
  This is the UART vhdl source file that controls the serialization of a byte
9) serial_out_ctrl.vhd
  This is the vhdl source for the module that is tasked with controlling the
  flow of data into the uart. It is setup to read data from RAM sequentially,
  using the address and data lines. It is triggered by the positive edge of 
  tx_trigger.
10) transmitter.vhd
  This module is a top layer that encapsulates the uart and serial_out_ctrl.
11) uart_transmitter_test.vhd
  This is the top module for the transmitter test. It uses the BTC button
  on the basys3 board to trigger transmission.
12) vga.vhd
  This is the module that generates the control signals for vga and controls 
  image generation, by reading from RAM and outputting the correct pixel values.
13) vga_test.vhd
  This is the top module for the vga test setup. It has been modified several times,
  and now includes the entire integration of scale_down_two_test to VGA.
  
----------------------------------------------------------------------------
Instructions to compile and run scaled down by two algorithm in simulation:
As such nothing needs to be changed in the code. The steps to compile are as
follows:

1) Follow usual procedure to make a work directory using vsim
2) Compile, src/bl_rom.vhd, src/blk_ram.vhd, src/scale_down_two.vhd and
   tb/tb_scale_down_two.vh
3) Simulate without optimization (on tb_scale_down_two)
4) log -r * and run -a
5) copy run/output_img.txt to verification folder
6) run verification/scale_down_two_test.m matlab script to see output

-----------------------------------------------------------------------------
Instructions to run the two top module tests:
1) Set the module as the top module
2) Begin Synthesis, Implementation, Generate Bitstream, program board.
-----------------------------------------------------------------------------